{%- comment -%}
  Usage: _includes example.html content=markup [args],
  where content is a capture with the HTML content

  args can be one of the following:
    id - null (default)
    class - "bd-example" (default)
    optional: hide_preview - disabled (default)
    optional: hide_markup - disabled (default)
{%- endcomment -%}

{%- assign id = _includes.id -%}
{%- assign class = _includes.class -%}

{%- if _includes.hide_preview == null -%}
<div{% if id %} id="{{ id }}"{% endif %} class="bd-example{% if class %} {{ class }}{% endif %}">
  {{- _includes.content -}}
</div>
{%- endif -%}

{%- if _includes.hide_markup == null -%}
  {%- highlight html -%}
    {%- if _includes.content contains '<svg class="bd-placeholder-img' -%}
      {%- assign modified_content = _includes.content
        | replace: '<svg class="bd-placeholder-img', '✂️<svg class="bd-placeholder-img'
        | replace: '</svg>', '</svg>✂️'
        | split: '✂️' -%}

      {%- if _includes.content contains 'bd-placeholder-img ' -%}
        {%- assign image_class = _includes.content
          | replace_first: 'bd-placeholder-img', 'bd-placeholder-img ✂️'
          | replace: '" width="', '✂️" width="'
          | split: '✂️' -%}
        {%- assign image_class = image_class[1] | replace: 'bd-placeholder-img-lg', '' | strip -%}
      {%- endif -%}

      {%- for content_chunk in modified_content -%}
        {%- if content_chunk contains '<svg class="bd-placeholder-img' -%}
          {%- capture img_placeholder -%}
            <img src="..." {% if image_class %}class="{{ image_class }}" {% endif %}alt="...">
          {%- endcapture -%}
          {{- img_placeholder -}}
        {%- else -%}
          {{- content_chunk -}}
        {%- endif -%}
      {%- endfor -%}
    {%- else -%}
      {{- _includes.content -}}
    {%- endif -%}
  {%- endhighlight -%}
{%- endif -%}
